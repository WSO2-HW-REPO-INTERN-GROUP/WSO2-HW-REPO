<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <title>WSO2 Hardware Repository</title>
        <link href="css/global.css" rel="stylesheet" type="text/css" media="all">
        <link href="css/main.css" rel="stylesheet" type="text/css" media="all">
        <link href="css/dialog.css" rel="stylesheet" type="text/css" media="all">
        <link href="css/adminIssueDetails.css" rel="stylesheet" type="text/css" media="all">
        <link rel="stylesheet" href="css/carbonFormStyles.css">
        <link rel="stylesheet" href="css/jquery-ui.css">
        <link rel="icon" href="https://10.217.234.165:9443/carbon/admin/images/favicon.ico" type="image/x-icon">
        <link rel="shortcut icon" href="https://10.217.234.165:9443/carbon/admin/images/favicon.ico" type="image/x-icon">
        <!--<script type="text/javascript" src="js/jquery-1.5.2.min.js"></script>-->
        <!--<script type="text/javascript" src="js/jquery.form.js"></script>-->
        <!--<script type="text/javascript" src="js/jquery-ui.min.js"></script>-->
        <!--<script type="text/javascript" src="js/jquery.validate.js"></script>-->
        <!--<script type="text/javascript" src="js/jquery.cookie.js"></script>-->
        <!--<script type="text/javascript" src="js/jquery.ui.core.min.js"></script>-->
        <!--<script type="text/javascript" src="js/jquery.ui.widget.min.js"></script>-->
        <!--<script type="text/javascript" src="js/jquery.ui.tabs.min.js"></script>-->
        <!--<script type="text/javascript" src="js/main.js"></script>-->
        <!--<script type="text/javascript" src="js/WSRequest.js"></script>-->
        <!--<script type="text/javascript" src="js/cookies.js"></script>-->
        <!--<script type="text/javascript" src="js/jquery.ui.datepicker.js"></script>-->
        <script type="text/javascript" src="js/jquery-1.9.1.js"></script>
        <script type="text/javascript" src="js/jquery-ui.js"></script>
        <script type="text/javascript" src="js/customControls.js"></script>
        <!-- This script handles the tabbed pane functionality -->
        <script>
            //
                    jQuery(document).ready(function(){
            
                        var clickCounter=0;
                        var deviceID;
                        var issueID
            
                        //read the id value sent via the url
                        readURL();
                        var accesoryRemarks;
                        //operations();
            
                        function readURL(){
                            var urlData=window.location.search.substring(1);
                            issueID=urlData.split("=");
            
                            $.post("admin_data_get.jag",{operation:"getissueDetails",issueID:issueID[1]},function(data,status){
                                var i=0;
            
                                var issueDetailsTbl=document.getElementById('issueDetailsTable');
                                var issueDetailsArea=document.getElementById("issueDetailsDiv");
                                issueDetailsArea.setAttribute('class','datagrid');
                                var tbody=document.createElement('tbody');
            
                                var object=JSON.parse(data);
            
                                    alert(data);
            
                                    for(var property in object){

                                        if(property=="device_id"){
                                            deviceID=object[property];
                                        }
            
                                        var newRow=document.createElement('tr');
            
                                        if(i%2==0){
                                            newRow.setAttribute("class","alt");
                                        }

                                        if(property=="resolved"){
                                            if(object[property]=="0"){
                                                //$("#issueResolve").hide();
                                                $("#viewUpgrades").hide();
                                            }
                                            else if(object[property]=="1"){
                                                $("#issueReject").hide();
                                                $("#issueResolve").hide();
                                            }
                                        }
                                        else{
                                            var td1=document.createElement('td');
                                            var td2=document.createElement('td');
                                            td1.style.padding='3px 20px';
                                            td2.style.padding='3px 20px';
                
                                            td1.appendChild(document.createTextNode(property));
                                            td2.appendChild(document.createTextNode(object[property]));
                
                                            newRow.appendChild(td1);
                                            newRow.appendChild(td2);
                                            tbody.appendChild(newRow);
                
                                            i++;
                                        }
            
                                        
                                    }
                                issueDetailsTbl.appendChild(tbody);
                            });
                        }
            
                        // function operations(){
                        //     $.post("getOperationValues.jag",{selectedTxt:"Device3",operation:"btnHide"},function(data,status){
                        //         var parsed=JSON.parse(data);
                        //         if(parsed["newIssue"]){
                        //             $("#issueResolve").hide();
                        //             $("#viewUpgrades").hide();
                        //         }
                        //         else if(!(parsed["newIssue"])){
                        //             $("#issueAccept").hide();
                        //             $("#issueReject").hide();
                        //         }
                        //     });
                        // }
            
                        $("#addUpgradeForm").dialog({
                            autoOpen:false,
                            height: 400,
                            width: 600,
                            modal: true,
                            buttons:{
                                'Confirm': function() {
                                    var deviceType=$("#hardwareTypeSelect").val();
                                    var description=$("#upgradeDescriptionArea").val();
                                    var hardware=$("#hardwareSelect").val();

                                    if(description==""||deviceType=='0'){
                                        errSpan.textContent="Please enter upgrade description or select device type";
                                        errSpan.setAttribute("class","error");
                                    }
                                    else{
                                        errSpan.style.display="none";

                                        $.post("admin_requests_handler.jag",{deviceType:deviceType,description:description,hardware:hardware,request:"addNewUpgrade"},function(data){
                                        });
                                        $(this).dialog('close');
                                    }
                                }
                            }
                        });
            
                        $("#hardwareTypeSelect").change(function() {
            
                            var selectedText=$("#hardwareTypeSelect :selected").text();

                            accesoryRemarks=[];
            
                            //empty the dropdown
                             $("#hardwareSelect").empty();
            
                            // //send the post for processing
                            $.post("admin_data_get.jag",{searchText:selectedText,operation:"getAccessory"},function(data,status){
                                var parsed=JSON.parse(data);
                                var option="";
            
                                //add all the available options
                                $("#hardwareSelect").append('<option value="-1">Select Hardware</option>');
                                for(var i=0;i< parsed.length;i++){
                                    var obj=parsed[i];
                                    accesoryRemarks[i]=obj["remarks"];
                                    option="<option value='"+i+"'>"+obj["accessory_id"]+"</option>";
                                    $("#hardwareSelect").append(option);
                                    alert(obj["accessory_id"]);
                                }
                                
                            });
                        });

                        $("#hardwareSelect").change(function() {

                            var selectedValue=$("#hardwareSelect :selected").val();
                            alert("selectedValue--"+selectedValue);
                            var detailsArea=document.getElementById("componentDetailsArea");
                            detailsArea.innerHTML=accesoryRemarks[selectedValue];

                        });
                        
            
                        $("#addUpgrade").click(function(event){
                            event.preventDefault();
                            $("#addUpgradeForm").dialog("open");
                        });

                        $("#issueReject").click(function(){
                            //reject issue request
                            alert("reject Clicked");
                            $.post("admin_devices_updates.jag",{operation:"acceptRejcet",issue_id:issueID[1],value:"3"},function(data,status){
                                alert(data);
                            });
                        });

                        $("#issueResolve").click(function(){
                            //reject issue request
                            alert("resolve Clicked");
                            $.post("admin_devices_updates.jag",{operation:"acceptRejcet",issue_id:issueID[1],value:"1"},function(data,status){
                                alert(data);
                            });
                        });


            
                        $("#viewUpgrades").click(function(){
                            if(clickCounter==0){
            
                                $.post("admin_data_get.jag",{operation:"upgradeHistory",device_id:deviceID},function(data,status){
            
                                    var objArray=JSON.parse(data);

                                    alert(objArray.length);
            
                                    var tablearea = document.getElementById('upgradeHistoryDiv');
                                    tablearea.setAttribute("class","datagrid");

                                    if(objArray.length==0){
                                        var noUpgradeDiv=document.getElementById("noUpgradeFoundDiv");
                                        noUpgradeDiv.style.display="";
                                    }
                                    else{

                                        var noUpgradeDiv=document.getElementById("noUpgradeFoundDiv");
                                        noUpgradeDiv.style.display="none";
            
                                        for(var i=0;i<objArray.length;i++){
                
                                            var cntr=0;
                
                                            var newTable=document.createElement('table');
                                            newTable.style.width='600px';
                                            newTable.style.margin='0px 0px 15px 50px';
                
                                            var thead=document.createElement('thead');
                                            var htr=document.createElement('tr');
                                            var th=document.createElement('th');
                                            var tbody=document.createElement('tbody');
                                            th.setAttribute('colspan','2');
                                            th.style.height='15px';
                                            htr.appendChild(th);
                                            thead.appendChild(htr);
                                            newTable.appendChild(thead);
                
                                            var object=objArray[i];
                
                                            for(var property in object){

                                                    
                
                                                var newRow=document.createElement('tr');
                
                                                if(cntr%2==0){
                                                    newRow.setAttribute("class","alt");
                                                }
                
                                                if(property=='upgrade_id'){
                                                    th.appendChild(document.createTextNode("Upgrade ID: "+object[property]));
                                                }
                
                                                else{
                
                                                    var td1=document.createElement('td');
                                                    var td2=document.createElement('td');
                
                                                    td1.appendChild(document.createTextNode(property));
                                                    td2.appendChild(document.createTextNode(object[property]));
                
                                                    newRow.appendChild(td1);
                                                    newRow.appendChild(td2);
                
                                                    tbody.appendChild(newRow);
                
                                                }
                
                                                cntr++;
                
                                            }
                                            newTable.appendChild(tbody);
                
                                            tablearea.appendChild(newTable);
                                        }
                                    }
            
                                    clickCounter++;
                                });
                            }
                        });
                    });
                
        </script>
    </head>
    <body>
        <noscript>
            &lt;div class="something-wrong"&gt;
            &lt;div class="title"&gt;JavaScript is disabled on your browser&lt;/div&gt;
            &lt;div class="content"&gt;Please enable JavaScript or upgrade to a JavaScript-capable browser to use WSO2 Products.&lt;/div&gt;
            &lt;/div&gt;
        </noscript>

        <div id="dcontainer"></div>
        <script type="text/javascript" src="./page2_files/dialog.js"></script>
        <!-- JS imports for collapsible menu -->
        <script src="./page2_files/yahoo-dom-event.js" type="text/javascript"></script>
        <script src="./page2_files/animation-min.js" type="text/javascript"></script>
        <script src="./page2_files/template.js" type="text/javascript"></script>
        <script src="./page2_files/yahoo-min.js" type="text/javascript"></script>
        <script src="./page2_files/selector-min.js" type="text/javascript"></script>
        <table id="main-table" border="0" cellspacing="0">
            <tbody>
                <tr>
                    <td id="header" colspan="3">
                        <div id="header-div">
                            <div class="right-logo">Management Console</div>
                            <div class="left-logo">
                            </div>
                            <div class="middle-ad">
                            </div>
                            <div class="header-links">
                                <div class="right-links">
                                    <ul>
                                        <li class="middle">
                                            <label id="logged-user">
                                            <strong>Signed-in as:</strong>&nbsp;admin@carbon.super
                                            </label>
                                        </li>
                                        <li class="middle">|</li>
                                        <li class="right">
                                            <a href="https://localhost:9443/carbon/admin/logout_action.jsp">Sign-out</a>
                                        </li>
                                        <li class="middle">|</li>
                                        <li class="middle">
                                            <a target="_blank" href="http://docs.wso2.org/wiki/display/AS521/WSO2+Application+Server+Documentation">Docs</a>
                                        </li>
                                        <li class="middle">|</li>
                                        <li class="left">
                                            <a target="_blank" href="https://localhost:9443/carbon/docs/about.html">About</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td id="menu-panel" valign="top" height="400px">
                        <div id='mainMenu'>
                            <ul>
                                <li><a href='admin_home.jag'><span>Home</span></a></li>
                                <li><a href='admin_devices.jag'><span>Devices</span></a></li>
                                <li><a href='admin_requests.jag'><span>Requests</span></a></li>
                                <li class='last'><a href='#'><span>Report Generation</span></a></li>
                            </ul>
                        </div>
                    </td>
                    <td id="middle-content">
                        <table id="content-table" border="0" cellspacing="0">
                            <tbody>
                                <tr>
                                    <td id="page-header-links">
                                        <table class="page-header-links-table" cellspacing="0">
                                            <tbody>
                                                <tr>
                                                    <td class="breadcrumbs">
                                                        <table class="breadcrumb-table" cellspacing="0">
                                                            <tbody>
                                                                <tr>
                                                                    <td>
                                                                        <div id="breadcrumb-div"></div>
                                                                    </td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </td>
                                                    <td class="page-header-help"><a href="https://localhost:9443/carbon/sequences/docs/userguide.html" target="_blank">Help</a></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </td>
                                </tr>
                                <!--This is edited for issue details implementation -->
                                <tr>
                                    <td>
                                        <div id="mainContainer" class="main_container">
                                            <div id="issueDetailsDiv">
                                                <table id="issueDetailsTable" style="width: 600px;">
                                                    <thead>
                                                        <tr>
                                                            <th style="height: 15px" colspan="2">Issue Details</th>
                                                        </tr>
                                                    </thead>
                                                </table>
                                            </div>
                                            <div id="issueOperationsDiv">
                                                <!-- <input type="button" id="issueAccept" value="Accept" class="siteButton" />-->
                                                <input type="button" value="Reject" id="issueReject" class="siteButton"/> 
                                                <input type="button" id="issueResolve" value="Resolve" class="siteButton"/><input type="button" id="addUpgrade" value="New Upgrade" class="siteButton"/>
                                                </br><a id="viewUpgrades">View Upgrade History</a>
                                            </div>
                                            <div id="upgradeHistoryDiv">
                                                <table id="upgradeHistoryTable">
                                                    <thead>
                                                        <tr>
                                                            <td colspan="2"></td>
                                                        </tr>
                                                    </thead>
                                                </table>
                                                <div style="display:none" id="noUpgradeFoundDiv">
                                                    <span>No Ugrades Were Found Related to this Device</span>
                                                </div>
                                            </div>
                                            <div id="addUpgradeForm">
                                                <form>
                                                    <table style="width: 500px;margin: auto;" cellspacing="25px">
                                                        <tr>
                                                            <td><label id="selectHardwareTypeLbl">Select Device Type</label></td>
                                                            <td>
                                                                <select id="hardwareTypeSelect" class="siteButton">
                                                                    <option id="option1" selected value="0">--Select Device Type--</option>
                                                                    <option id="option2" value="1">Battery</option>
                                                                    <option id="option3" value="2">Ram</option>
                                                                </select>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td><label id="selectHardwareLbl">Select Device Type</label></td>
                                                            <td>
                                                                <select id="hardwareSelect" class="siteButton">
                                                                    <option id="option11" value="default">--Select Device--</option>
                                                                </select>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td colspan="2">
                                                                <label id="componentDetailsLbl">Hardware Details</label><br/><br/>
                                                                <div id="componentDetailsArea" style="border-color: #0099ff;width: 450px;height: 100px;border: 2px solid"></div>
                                                            </td>
                                                        </tr>
                                                        <tr>
                                                            <td colspan="2">
                                                                <label>Upgrade Description</label><br/><br/>
                                                                <textarea rows="10" cols="55" id="upgradeDescriptionArea" class="textArea"></textarea>
                                                            </td>
                                                        </tr>
                                                        <tr><td colspan="2"><span id="errSpan"></span></td></tr>
                                                    </table>
                                                </form>
                                            </div>
                                        </div>
                                    </td>
                                </tr>
                                <!-- End of issue details generation -->
                            </tbody>
                        </table>
                    </td>
                </tr>
                <tr>
                    <td id="footer" colspan="3">
                        <div id="footer-div">
                            <div class="footer-content">
                                <div class="copyright">
                                    © 2005 - 2013 WSO2 Inc. All Rights Reserved.
                                </div>
                            </div>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <script type="text/javascript">
            if (Function('/*@cc_on return document.documentMode===10@*/')()){
            document.documentElement.className+=' ie10';
            }
        </script>
    </body>
</html>